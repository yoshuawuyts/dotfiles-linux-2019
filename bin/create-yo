#!/bin/sh

main () {
  # find command
  while true; do
    case "$1" in
      -h|--help) usage "$0" && exit 1 ;;
      -- ) shift; break ;;
      * ) break ;;
    esac
  done

  # verify arg count
  if [ $# != 1 ]; then
    printf "Error: function_name required\n"
    usage "$0" && exit 2
  fi

  trap clean SIGHUP SIGINT SIGTERM

  fn_name="$1"
  create_yo \
    | sed 's/^  //' \
    | sed "s/FN_NAME/$fn_name/g"
}

usage () {
  printf "Usage: %s <function_name>\n" "$(basename "$1")"
}

create_yo () {
cat << 'END'
  const sf = require('sheetify')
  const yo = require('yo-yo')

  const prefix = sf``

  module.exports = FN_NAME

  function FN_NAME () {
    return yo`
      <section class=${prefix}>
      </section>
    `
  }
END
}

clean () {
  printf "cleaning up\n"
}

assert_dep () {
  "$1" --help > /dev/null 2>&1
  [ $? -eq 0 ] && return
  [ $? -ne 0 ] && man "$1" > /dev/null
  [ $? -ne 0 ] && { printf "dependency %s not found\n" "$1"; exit 1; }
}

# reorder args and pass to main()
getopt -T > /dev/null
if [ "$?" -eq 4 ]; then args="$(getopt --long help --options h -- "$*")"
else args="$(getopt h "$*")"; fi
[ ! $? -eq 0 ] && { usage "$0" && exit 2; }
eval set -- "$args"
main "$@"
