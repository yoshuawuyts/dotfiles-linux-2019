#!/bin/sh
set -e

SESSION='_shared'

create_session () {
  tmux new-session -d -s "$SESSION" -n 'WeeChat' weechat

  tmux new-window -n 'media' cmus
  tmux split-window -h && tmux send-keys rtorrent C-m
  tmux split-window -v && tmux send-keys newsbeuter C-m

  local logpath=/Users/"$USER"/src/"$USER"/knowledge
  tmux new-window -n 'log' -c "$logpath"
  tmux send-keys "$EDITOR" C-m
  tmux split-window -h -c "$logpath"
  tmux resize-pane -R 5

  local confpath=/Users/"$USER"/src/"$USER"/dotfiles
  tmux new-window -n 'conf' -c "$confpath"
  tmux send-keys "$EDITOR" C-m
  tmux split-window -h -c "$confpath"
  tmux resize-pane -R 5
}

if ! (tmux list-sessions | cut -d ':' -f 1 | grep -q ^"$SESSION"\$); then
  create_session
fi
